name: Save history1 and history2 every 10 minutes

on:
  workflow_dispatch:
  schedule:
    - cron: "*/10 * * * *"  # 10分ごと

jobs:
  save-history1:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - run: |
          timestamp=$(date +'%Y%m%d_%H%M%S')
          python save.py history1
          tar -czf history1_${timestamp}.tar.gz -C data/history1 .
          mv history1_${timestamp}.tar.gz /tmp/
          echo "TIMESTAMP=$timestamp" >> $GITHUB_ENV
      - uses: actions/upload-artifact@v4
        with:
          name: saved-pages-history1-${{ env.TIMESTAMP }}
          path: /tmp/history1_${{ env.TIMESTAMP }}.tar.gz

  save-history2:
    needs: save-history1
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - run: |
          timestamp=$(date +'%Y%m%d_%H%M%S')
          python save.py history2
          tar -czf history2_${timestamp}.tar.gz -C data/history2 .
          mv history2_${timestamp}.tar.gz /tmp/
          echo "TIMESTAMP=$timestamp" >> $GITHUB_ENV
      - uses: actions/upload-artifact@v4
        with:
          name: saved-pages-history2-${{ env.TIMESTAMP }}
          path: /tmp/history2_${{ env.TIMESTAMP }}.tar.gz
